<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FaceSwap - Transform Your Moments with AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.20.15/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Animations */
        .animate-slide-up {
            animation: slideUp 0.8s ease-out;
        }

        @keyframes slideUp {
            0% { opacity: 0; transform: translateY(30px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .animate-fade-in {
            animation: fadeIn 1s ease-in;
        }

        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        /* Hero gradient */
        .hero-gradient {
            background: linear-gradient(135deg, #4F46E5 0%, #14B8A6 100%);
        }

        /* Face box styling */
        .face-box {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 1rem;
            background-color: #ffffff;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .face-box:hover {
            transform: translateY(-6px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .face-box.selected {
            border-color: #14B8A6;
            background-color: #ecfdf5;
            box-shadow: 0 8px 16px rgba(20, 184, 166, 0.3);
        }

        .face-box img {
            width: 100%;
            height: 140px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 0.75rem;
        }

        .face-box .face-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #1f2937;
        }

        /* Face indicator */
        .face-indicator {
            position: absolute;
            border: 3px solid rgba(79, 70, 229, 0.8);
            background-color: rgba(79, 70, 229, 0.3);
            border-radius: 10px;
            transition: all 0.3s;
        }

        .face-indicator.highlighted {
            border-color: #14B8A6;
            background-color: rgba(20, 184, 166, 0.4);
        }

        .face-indicator::after {
            content: attr(data-face-index);
            position: absolute;
            top: -12px;
            left: -12px;
            background-color: #4F46E5;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: bold;
        }

        /* Custom button */
        .btn-primary {
            background: linear-gradient(90deg, #4F46E5, #14B8A6);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* Card hover effect */
        .card-hover {
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card-hover:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        /* Tab styling */
        .tab {
            transition: all 0.3s;
        }

        .tab.active {
            background: linear-gradient(90deg, #4F46E5, #14B8A6);
            color: white;
        }

        /* Dark mode overrides */
        .dark-mode {
            background-color: #1F2937;
            color: #D1D5DB;
        }

        .dark-mode .bg-white {
            background-color: #374151;
        }

        .dark-mode .bg-gray-50 {
            background-color: #4B5563;
        }

        .dark-mode .bg-gray-100 {
            background-color: #1F2937;
        }

        .dark-mode .text-gray-600 {
            color: #D1D5DB;
        }

        .dark-mode .text-gray-900 {
            color: #F3F4F6;
        }

        .dark-mode .border-gray-300 {
            border-color: #6B7280;
        }

        .dark-mode .bg-blue-100 {
            background-color: #4B5563;
        }

        .dark-mode .text-blue-700 {
            color: #14B8A6;
        }

        .dark-mode .bg-green-600 {
            background-color: #10B981;
        }

        .dark-mode .bg-red-100 {
            background-color: #7F1D1D;
        }

        .dark-mode .text-red-700 {
            color: #FECACA;
        }

        .dark-mode .face-box {
            background-color: #4B5563;
            border-color: #6B7280;
        }

        .dark-mode .face-box.selected {
            background-color: #064E3B;
        }

        .dark-mode .face-box .face-label {
            color: #D1D5DB;
        }

        /* Fixed size for upload boxes */
        .upload-box {
            width: 500px;
            height: 400px;
            max-width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .upload-box img,
        .upload-box video {
            object-fit: contain;
            max-width: 100%;
            max-height: 100%;
            width: 100%;
            height: 100%;
        }

        .upload-box .preview-container {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-900">
    <div id="root"></div>
    <script type="text/babel">
        function App() {
            const [sourceImageFile, setSourceImageFile] = React.useState(null);
            const [targetImageFile, setTargetImageFile] = React.useState(null);
            const [sourceVideoFile, setSourceVideoFile] = React.useState(null);
            const [targetVideoFile, setTargetVideoFile] = React.useState(null);
            const [targetFaces, setTargetFaces] = React.useState([]);
            const [selectedFaceIndex, setSelectedFaceIndex] = React.useState(null);
            const [highlightedFaceIndex, setHighlightedFaceIndex] = React.useState(null);
            const [resultImage, setResultImage] = React.useState(null);
            const [resultVideo, setResultVideo] = React.useState(null);
            const [loading, setLoading] = React.useState(false);
            const [error, setError] = React.useState(null);
            const [isDarkMode, setIsDarkMode] = React.useState(false);
            const [showFaceSelection, setShowFaceSelection] = React.useState(false);
            const [targetImageDimensions, setTargetImageDimensions] = React.useState({ width: 0, height: 0 });
            const [activeTab, setActiveTab] = React.useState('image');

            // Theme toggle
            const toggleTheme = () => {
                setIsDarkMode(!isDarkMode);
            };

            // Rename and convert file to .jpg for images or keep video format
            const renameFile = (file, newName, isImage) => {
                if (isImage) {
                    const fileName = file.name.toLowerCase();
                    if (fileName.endsWith('.jpg') || fileName.endsWith('.jpeg')) {
                        return new File([file], newName, { type: file.type });
                    }
                    return new File([file], newName, { type: 'image/jpeg' });
                }
                return new File([file], newName, { type: file.type });
            };

            // Handle file selection with size validation
            const handleSourceImageChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 5_000_000) {
                        setError("Source image too large (max 5MB).");
                        setSourceImageFile(null);
                        return;
                    }
                    const renamedFile = renameFile(file, 'source.jpg', true);
                    setSourceImageFile(renamedFile);
                    setSourceVideoFile(null);
                    setTargetFaces([]); // Reset faces to allow re-detection
                    setSelectedFaceIndex(null);
                    setShowFaceSelection(false);
                } else {
                    setSourceImageFile(null);
                }
            };

            const handleTargetImageChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 5_000_000) {
                        setError("Target image too large (max 5MB).");
                        setTargetImageFile(null);
                        return;
                    }
                    const renamedFile = renameFile(file, 'target.jpg', true);
                    setTargetImageFile(renamedFile);
                    setTargetVideoFile(null);
                    setTargetFaces([]);
                    setSelectedFaceIndex(null);
                    setShowFaceSelection(false);
                    
                    const img = new Image();
                    img.onload = (e) => {
                        setTargetImageDimensions({
                            width: e.target.naturalWidth,
                            height: e.target.naturalHeight
                        });
                    };
                    img.src = URL.createObjectURL(renamedFile);
                } else {
                    setTargetImageFile(null);
                    setTargetFaces([]);
                    setSelectedFaceIndex(null);
                    setShowFaceSelection(false);
                }
            };

            const handleSourceVideoChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 50_000_000) {
                        setError("Source video too large (max 50MB).");
                        setSourceVideoFile(null);
                        return;
                    }
                    const renamedFile = renameFile(file, 'source.mp4', false);
                    setSourceVideoFile(renamedFile);
                    setSourceImageFile(null);
                } else {
                    setSourceVideoFile(null);
                }
            };

            const handleTargetVideoChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 50_000_000) {
                        setError("Target video too large (max 50MB).");
                        setTargetVideoFile(null);
                        return;
                    }
                    const renamedFile = renameFile(file, 'target.mp4', false);
                    setTargetVideoFile(renamedFile);
                    setTargetImageFile(null);
                    setTargetFaces([]);
                    setSelectedFaceIndex(null);
                    setShowFaceSelection(false);
                } else {
                    setTargetVideoFile(null);
                    setTargetFaces([]);
                    setSelectedFaceIndex(null);
                    setShowFaceSelection(false);
                }
            };

            // Detect faces in target image or video
            const detectFaces = async () => {
                if (!targetImageFile && !targetVideoFile) {
                    setError("Please upload a target image or video.");
                    return false;
                }
                
                setLoading(true);
                setError(null);
                
                const formData = new FormData();
                if (targetImageFile) {
                    formData.append("target", targetImageFile);
                } else {
                    formData.append("target", targetVideoFile);
                }
                
                try {
                    const response = await fetch("https://face-detection-pkw8.onrender.com/detect-faces/", {
                        method: "POST",
                        body: formData,
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.detail || "Failed to detect faces");
                    }
                    
                    const data = await response.json();
                    setTargetFaces(data.faces);
                    
                    if (data.faces.length === 0) {
                        setError("No faces detected in the target.");
                        return false;
                    } else if (data.faces.length === 1 && activeTab === 'image') {
                        setSelectedFaceIndex(0); // Auto-select single face
                        setShowFaceSelection(false);
                        return true;
                    } else {
                        setShowFaceSelection(true);
                        return false; // Wait for user to select a face
                    }
                } catch (err) {
                    setError("Failed to detect faces: " + err.message);
                    return false;
                } finally {
                    setLoading(false);
                }
            };

            // Handle face selection
            const handleFaceSelect = (index) => {
                setSelectedFaceIndex(index === selectedFaceIndex ? null : index);
            };

            const handleFaceMouseEnter = (index) => {
                setHighlightedFaceIndex(index);
            };

            const handleFaceMouseLeave = () => {
                setHighlightedFaceIndex(null);
            };

            // Calculate face indicator position
            const calculateFacePosition = (face) => {
                if (!targetImageDimensions.width || !targetImageDimensions.height) {
                    return { left: 0, top: 0, width: 0, height: 0 };
                }
                
                const previewWidth = 500;
                const previewHeight = 400;
                const scaleFactorX = previewWidth / targetImageDimensions.width;
                const scaleFactorY = previewHeight / targetImageDimensions.height;
                const scaleFactor = Math.min(scaleFactorX, scaleFactorY);
                
                return {
                    left: `${face.x * scaleFactor * 100}%`,
                    top: `${face.y * scaleFactor * 100}%`,
                    width: `${face.width * scaleFactor * 100}%`,
                    height: `${face.height * scaleFactor * 100}%`,
                };
            };

            // Handle submit (image or video)
            const handleSubmit = async (e) => {
                e.preventDefault();
                if (activeTab === 'image' && (!sourceImageFile || !targetImageFile)) {
                    setError("Please upload both source and target images.");
                    return;
                }
                if (activeTab === 'video' && (!sourceVideoFile || !targetVideoFile)) {
                    setError("Please upload both source and target videos.");
                    return;
                }

                // Detect faces if not already done
                if (targetFaces.length === 0) {
                    const canProceed = await detectFaces();
                    if (!canProceed) return; // Stop if no faces or multiple faces requiring selection
                }

                // For multiple faces, require selection
                if (targetFaces.length > 1 && selectedFaceIndex === null) {
                    setError("Please select a face from the target.");
                    return;
                }

                setLoading(true);
                setError(null);
                setResultImage(null);
                setResultVideo(null);

                const formData = new FormData();
                formData.append("face_index", selectedFaceIndex || 0);
                if (activeTab === 'image') {
                    formData.append("source", sourceImageFile);
                    formData.append("target", targetImageFile);
                } else {
                    formData.append("source", sourceVideoFile);
                    formData.append("target", targetVideoFile);
                }

                try {
                    const response = await fetch(
                        activeTab === 'image'
                            ? "https://face-swap-api-7fb0.onrender.com/swap-faces/"
                            : "https://face-swap-api-7fb0.onrender.com/swap-faces-video/",
                        {
                            method: "POST",
                            body: formData,
                        }
                    );

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.detail || `Failed to swap faces in ${activeTab}`);
                    }

                    const blob = await response.blob();
                    const url = URL.createObjectURL(blob);
                    if (activeTab === 'image') {
                        setResultImage(url);
                    } else {
                        setResultVideo(url);
                        setTargetVideoFile(null);
                        setTargetFaces([]);
                        setSelectedFaceIndex(null);
                        setShowFaceSelection(false);
                    }
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className={isDarkMode ? 'dark-mode' : ''}>
                    {/* Navigation */}
                    <nav className="bg-white shadow-lg fixed w-full z-50">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between h-16">
                                <div className="flex items-center">
                                    <h1 className="text-3xl font-bold text-gray-900">FaceSwap</h1>
                                </div>
                                <div className="flex items-center space-x-6">
                                    <a href="#home" className="text-gray-600 hover:text-indigo-600 font-medium">Home</a>
                                    <a href="#swap" className="text-gray-600 hover:text-indigo-600 font-medium">Swap</a>
                                    <a href="#features" className="text-gray-600 hover:text-indigo-600 font-medium">Features</a>
                                    <a href="#contact" className="text-gray-600 hover:text-indigo-600 font-medium">Contact</a>
                                    <button
                                        onClick={toggleTheme}
                                        className="p-2 rounded-full bg-gray-100 hover:bg-gray-200"
                                        title={`Switch to ${isDarkMode ? 'Bright' : 'Dark'} Mode`}
                                    >
                                        <i className={`fas ${isDarkMode ? 'fa-sun' : 'fa-moon'} text-indigo-600`}></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </nav>

                    {/* Hero Section */}
                    <section id="home" className="hero-gradient pt-24 pb-24">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                            <h2 className="text-5xl sm:text-6xl font-extrabold text-white animate-slide-up">
                                Transform Your Moments with FaceSwap
                            </h2>
                            <p className="mt-6 text-xl sm:text-2xl text-white opacity-90 max-w-3xl mx-auto animate-slide-up">
                                Swap faces in photos and videos effortlessly with our advanced AI technology. Fun, fast, and free!
                            </p>
                            <a
                                href="#swap"
                                className="mt-10 inline-block px-10 py-4 rounded-full text-white font-semibold text-lg btn-primary"
                            >
                                Start Swapping Now
                            </a>
                        </div>
                    </section>

                    {/* Features Section */}
                    <section id="features" className="py-24 bg-white">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <h2 className="text-4xl sm:text-5xl font-bold text-center mb-16 animate-slide-up">
                                Why FaceSwap?
                            </h2>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-12">
                                <div className="bg-gray-50 p-8 rounded-2xl card-hover animate-slide-up">
                                    <i className="fas fa-bolt text-4xl text-indigo-600 mb-4"></i>
                                    <h3 className="text-2xl font-semibold mb-4">Lightning Fast</h3>
                                    <p className="text-gray-600">
                                        Process face swaps in seconds with our high-performance AI.
                                    </p>
                                </div>
                                <div className="bg-gray-50 p-8 rounded-2xl card-hover animate-slide-up">
                                    <i className="fas fa-shield-alt text-4xl text-indigo-600 mb-4"></i>
                                    <h3 className="text-2xl font-semibold mb-4">Secure & Private</h3>
                                    <p className="text-gray-600">
                                        Your files are processed securely and deleted after use.
                                    </p>
                                </div>
                                <div className="bg-gray-50 p-8 rounded-2xl card-hover animate-slide-up">
                                    <i className="fas fa-video text-4xl text-indigo-600 mb-4"></i>
                                    <h3 className="text-2xl font-semibold mb-4">Image & Video Support</h3>
                                    <p className="text-gray-600">
                                        Swap faces in both photos and videos with ease.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </section>

                    {/* Face Swap Section */}
                    <section id="swap" className="py-24 bg-gray-100">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <h2 className="text-4xl sm:text-5xl font-bold text-center mb-16 animate-slide-up">
                                Create Your Face Swap
                            </h2>
                            <div className="bg-white rounded-3xl shadow-2xl p-8 sm:p-12">
                                {/* Tabs */}
                                <div className="flex justify-center mb-8">
                                    <button
                                        onClick={() => setActiveTab('image')}
                                        className={`tab px-6 py-3 rounded-l-lg text-lg font-medium ${activeTab === 'image' ? 'active' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}
                                    >
                                        Image Swap
                                    </button>
                                    <button
                                        onClick={() => setActiveTab('video')}
                                        className={`tab px-6 py-3 rounded-r-lg text-lg font-medium ${activeTab === 'video' ? 'active' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}
                                    >
                                        Video Swap
                                    </button>
                                </div>

                                <form onSubmit={handleSubmit} className="space-y-10">
                                    {loading && (
                                        <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50">
                                            <div className="flex flex-col items-center">
                                                <svg className="animate-spin h-10 w-10 text-white mb-4" viewBox="0 0 24 24">
                                                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                </svg>
                                                <span className="text-white text-xl font-semibold">Processing...</span>
                                            </div>
                                        </div>
                                    )}

                                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-12">
                                        {/* Source Upload */}
                                        <div>
                                            <label className="block text-xl font-semibold mb-4">
                                                Source {activeTab === 'image' ? 'Image' : 'Video'}
                                            </label>
                                            <div className="border-3 border-dashed border-gray-300 rounded-2xl bg-gray-50 upload-box mx-auto">
                                                {(sourceImageFile || sourceVideoFile) && (
                                                    <div className="preview-container">
                                                        {activeTab === 'image' ? (
                                                            <img
                                                                src={URL.createObjectURL(sourceImageFile)}
                                                                alt="Source Preview"
                                                                className="rounded-lg shadow-lg"
                                                            />
                                                        ) : (
                                                            <video
                                                                src={URL.createObjectURL(sourceVideoFile)}
                                                                className="rounded-lg shadow-lg"
                                                                controls
                                                            />
                                                        )}
                                                    </div>
                                                )}
                                            </div>
                                            <input
                                                type="file"
                                                accept={activeTab === 'image' ? 'image/*' : 'video/mp4,video/webm'}
                                                onChange={activeTab === 'image' ? handleSourceImageChange : handleSourceVideoChange}
                                                className="hidden"
                                                id="source-upload"
                                            />
                                            <label
                                                htmlFor="source-upload"
                                                className="cursor-pointer inline-flex items-center px-8 py-4 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 text-lg font-medium mt-4 mx-auto block"
                                            >
                                                <i className="fas fa-upload mr-3"></i>
                                                {activeTab === 'image'
                                                    ? (sourceImageFile ? `Change Source Image (${sourceImageFile.name})` : 'Upload Source Image')
                                                    : (sourceVideoFile ? `Change Source Video (${sourceVideoFile.name})` : 'Upload Source Video')}
                                            </label>
                                        </div>

                                        {/* Target Upload */}
                                        <div>
                                            <label className="block text-xl font-semibold mb-4">
                                                Target {activeTab === 'image' ? 'Image' : 'Video'}
                                            </label>
                                            <div className="border-3 border-dashed border-gray-300 rounded-2xl bg-gray-50 upload-box mx-auto">
                                                {(targetImageFile || targetVideoFile) && (
                                                    <div className="preview-container">
                                                        {activeTab === 'image' ? (
                                                            <>
                                                                <img
                                                                    src={URL.createObjectURL(targetImageFile)}
                                                                    alt="Target Preview"
                                                                    className="rounded-lg shadow-lg"
                                                                />
                                                                {targetFaces.length > 1 && (
                                                                    targetFaces.map((face, index) => {
                                                                        const position = calculateFacePosition(face);
                                                                        return (
                                                                            <div
                                                                                key={index}
                                                                                className={`face-indicator ${highlightedFaceIndex === index || selectedFaceIndex === index ? 'highlighted' : ''}`}
                                                                                style={position}
                                                                                data-face-index={index + 1}
                                                                                onMouseEnter={() => handleFaceMouseEnter(index)}
                                                                                onMouseLeave={handleFaceMouseLeave}
                                                                            />
                                                                        );
                                                                    })
                                                                )}
                                                            </>
                                                        ) : (
                                                            <video
                                                                src={URL.createObjectURL(targetVideoFile)}
                                                                className="rounded-lg shadow-lg"
                                                                controls
                                                            />
                                                        )}
                                                    </div>
                                                )}
                                            </div>
                                            <input
                                                type="file"
                                                accept={activeTab === 'image' ? 'image/*' : 'video/mp4,video/webm'}
                                                onChange={activeTab === 'image' ? handleTargetImageChange : handleTargetVideoChange}
                                                className="hidden"
                                                id="target-upload"
                                            />
                                            <label
                                                htmlFor="target-upload"
                                                className="cursor-pointer inline-flex items-center px-8 py-4 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 text-lg font-medium mt-4 mx-auto block"
                                            >
                                                <i className="fas fa-upload mr-3"></i>
                                                {activeTab === 'image'
                                                    ? (targetImageFile ? `Change Target Image (${targetImageFile.name})` : 'Upload Target Image')
                                                    : (targetVideoFile ? `Change Target Video (${targetVideoFile.name})` : 'Upload Target Video')}
                                            </label>
                                        </div>
                                    </div>

                                    {/* Face Selection */}
                                    {showFaceSelection && targetFaces.length > 1 && (
                                        <div className="mt-8 animate-fade-in">
                                            <h3 className="text-xl font-semibold text-center mb-6">
                                                Select a Face to Replace ({targetFaces.length} faces detected)
                                            </h3>
                                            <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-6">
                                                {targetFaces.map((face, index) => (
                                                    <div
                                                        key={index}
                                                        className={`face-box ${selectedFaceIndex === index ? 'selected' : ''}`}
                                                        onClick={() => handleFaceSelect(index)}
                                                        onMouseEnter={() => handleFaceMouseEnter(index)}
                                                        onMouseLeave={handleFaceMouseLeave}
                                                    >
                                                        <img
                                                            src={`data:image/jpeg;base64,${face.image_base64}`}
                                                            alt={`Face ${index + 1}`}
                                                        />
                                                        <div className="face-label">Face {index + 1}</div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}

                                    {/* Submit Button */}
                                    <div className="text-center">
                                        <button
                                            type="submit"
                                            disabled={loading || 
                                                (activeTab === 'image' && (!sourceImageFile || !targetImageFile)) || 
                                                (activeTab === 'video' && (!sourceVideoFile || !targetVideoFile))}
                                            className={`px-10 py-4 rounded-lg text-white font-semibold text-lg btn-primary ${loading || 
                                                (activeTab === 'image' && (!sourceImageFile || !targetImageFile)) || 
                                                (activeTab === 'video' && (!sourceVideoFile || !targetVideoFile)) ? 'opacity-50 cursor-not-allowed' : ''}`}
                                        >
                                            {loading ? (
                                                <div className="flex items-center">
                                                    <svg className="animate-spin h-6 w-6 mr-3 text-white" viewBox="0 0 24 24">
                                                        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                                        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                    </svg>
                                                    Processing...
                                                </div>
                                            ) : (
                                                targetFaces.length > 1 && selectedFaceIndex === null 
                                                    ? "Select a Face" 
                                                    : `Swap Faces in ${activeTab === 'image' ? 'Image' : 'Video'}`
                                            )}
                                        </button>
                                    </div>
                                </form>

                                {/* Result */}
                                {(resultImage || resultVideo) && (
                                    <div className="mt-12 animate-slide-up">
                                        <h3 className="text-2xl font-semibold text-center mb-6">Your Face Swap Result</h3>
                                        {resultImage && (
                                            <img
                                                src={resultImage}
                                                alt="Swapped Face"
                                                className="w-[90%] max-w-[896px] h-auto mx-auto rounded-lg shadow-2xl"
                                            />
                                        )}
                                        {resultVideo && (
                                            <video
                                                src={resultVideo}
                                                className="w-[90%] max-w-[896px] h-auto mx-auto rounded-lg shadow-2xl"
                                                controls
                                            />
                                        )}
                                        <div className="text-center mt-6">
                                            <a
                                                href={resultImage || resultVideo}
                                                download={resultImage ? 'faceswap_result.jpg' : 'faceswap_result.mp4'}
                                                className="inline-flex items-center px-8 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700"
                                            >
                                                <i className="fas fa-download mr-2"></i>
                                                Download Result
                                            </a>
                                        </div>
                                    </div>
                                )}

                                {/* Error Message */}
                                {error && (
                                    <div className="mt-8 p-6 bg-red-100 text-red-700 rounded-lg text-center animate-fade-in">
                                        <i className="fas fa-exclamation-circle mr-3 text-xl"></i>
                                        {error}
                                    </div>
                                )}
                            </div>
                        </div>
                    </section>

                    {/* Contact Section */}
                    <section id="contact" className="py-24 bg-white">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <h2 className="text-4xl sm:text-5xl font-bold text-center mb-16 animate-slide-up">
                                Get in Touch
                            </h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-12">
                                <div className="animate-slide-up">
                                    <h3 className="text-2xl font-semibold mb-6">Contact Information</h3>
                                    <p className="text-gray-600 mb-4">
                                        Questions or feedback? Our team is here to help you make the most of FaceSwap.
                                    </p>
                                    <p className="text-gray-600"><i className="fas fa-envelope mr-2"></i>support@faceswap.ai</p>
                                    <p className="text-gray-600"><i className="fas fa-phone mr-2"></i>+1 (800) 123-4567</p>
                                    <div className="flex space-x-4 mt-6">
                                        <a href="#" className="text-gray-600 hover:text-indigo-600"><i className="fab fa-twitter text-2xl"></i></a>
                                        <a href="#" className="text-gray-600 hover:text-indigo-600"><i className="fab fa-linkedin text-2xl"></i></a>
                                        <a href="#" className="text-gray-600 hover:text-indigo-600"><i className="fab fa-github text-2xl"></i></a>
                                    </div>
                                </div>
                                <div className="bg-gray-50 p-8 rounded-2xl shadow-lg animate-slide-up">
                                    <h3 className="text-2xl font-semibold mb-6">Send Us a Message</h3>
                                    <div className="space-y-6">
                                        <input
                                            type="text"
                                            placeholder="Your Name"
                                            className="w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-600"
                                        />
                                        <input
                                            type="email"
                                            placeholder="Your Email"
                                            className="w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-600"
                                        />
                                        <textarea
                                            placeholder="Your Message"
                                            rows="5"
                                            className="w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-600"
                                        ></textarea>
                                        <button
                                            className="w-full px-6 py-4 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 btn-primary"
                                        >
                                            Send Message
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    {/* Footer */}
                    <footer className="bg-gray-900 text-white py-12">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-12">
                                <div>
                                    <h3 className="text-2xl font-bold mb-6">FaceSwap</h3>
                                    <p className="text-gray-400">
                                        Transform your photos and videos with AI-powered face swapping.
                                    </p>
                                </div>
                                <div>
                                    <h4 className="text-lg font-semibold mb-4">Quick Links</h4>
                                    <ul className="space-y-2">
                                        <li><a href="#home" className="text-gray-400 hover:text-white">Home</a></li>
                                        <li><a href="#swap" className="text-gray-400 hover:text-white">Swap</a></li>
                                        <li><a href="#features" className="text-gray-400 hover:text-white">Features</a></li>
                                        <li><a href="#contact" className="text-gray-400 hover:text-white">Contact</a></li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 className="text-lg font-semibold mb-4">Resources</h4>
                                    <ul className="space-y-2">
                                        <li><a href="#" className="text-gray-400 hover:text-white">Blog</a></li>
                                        <li><a href="#" className="text-gray-400 hover:text-white">Support</a></li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 className="text-lg font-semibold mb-4">Follow Us</h4>
                                    <div className="flex space-x-4">
                                        <a href="#" className="text-gray-400 hover:text-white"><i className="fab fa-twitter text-2xl"></i></a>
                                        <a href="#" className="text-gray-400 hover:text-white"><i className="fab fa-linkedin text-2xl"></i></a>
                                        <a href="#" className="text-gray-400 hover:text-white"><i className="fab fa-github text-2xl"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div className="mt-12 text-center text-gray-400">
                                <p>© 2025 FaceSwap. All rights reserved.</p>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById("root"));
    </script>
</body>
</html>
