<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Swap</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.20.15/babel.min.js"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div id="root"></div>
    <script type="text/babel">
        function App() {
            const [sourceFile, setSourceFile] = React.useState(null);
            const [targetFile, setTargetFile] = React.useState(null);
            const [resultImage, setResultImage] = React.useState(null);
            const [loading, setLoading] = React.useState(false);
            const [error, setError] = React.useState(null);

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!sourceFile || !targetFile) {
                    setError("Please upload both source and target images.");
                    return;
                }

                setLoading(true);
                setError(null);
                setResultImage(null);

                const formData = new FormData();
                formData.append("source", sourceFile);
                formData.append("target", targetFile);

                try {
                    const response = await fetch("https://your-render-url.onrender.com/swap-faces/", {
                        method: "POST",
                        body: formData,
                    });

                    if (!response.ok) {
                        throw new Error((await response.json()).detail);
                    }

                    const blob = await response.blob();
                    const url = URL.createObjectURL(blob);
                    setResultImage(url);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            const handleDownload = () => {
                if (resultImage) {
                    const link = document.createElement("a");
                    link.href = resultImage;
                    link.download = "swapped_face_result.jpg";
                    link.click();
                }
            };

            return (
                <div className="bg-white p-8 rounded-lg shadow-lg max-w-md w-full">
                    <h1 className="text-2xl font-bold mb-6 text-center">Face Swap</h1>
                    <form onSubmit={handleSubmit} className="space-y-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-700">Source Image</label>
                            <input
                                type="file"
                                accept="image/*"
                                onChange={(e) => setSourceFile(e.target.files[0])}
                                className="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700">Target Image</label>
                            <input
                                type="file"
                                accept="image/*"
                                onChange={(e) => setTargetFile(e.target.files[0])}
                                className="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
                            />
                        </div>
                        <button
                            type="submit"
                            disabled={loading}
                            className={`w-full py-2 px-4 rounded text-white ${loading ? "bg-gray-400 cursor-not-allowed" : "bg-blue-600 hover:bg-blue-700"}`}
                        >
                            {loading ? "Processing..." : "Swap Faces"}
                        </button>
                    </form>
                    {error && <p className="mt-4 text-red-600">{error}</p>}
                    {loading && <div className="mt-4 text-blue-600 animate-pulse">Processing...</div>}
                    {resultImage && (
                        <div className="mt-6">
                            <h2 className="text-lg font-semibold mb-2">Result</h2>
                            <img src={resultImage} alt="Swapped Face" className="w-full rounded" />
                            <button
                                onClick={handleDownload}
                                className="mt-4 w-full py-2 px-4 bg-green-600 text-white rounded hover:bg-green-700"
                            >
                                Download Result
                            </button>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById("root"));
    </script>
</body>
</html>